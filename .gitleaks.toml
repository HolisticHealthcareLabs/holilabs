# Gitleaks Configuration for HoliLabs
# Healthcare application with HIPAA compliance requirements
#
# This configuration detects common secrets and healthcare-specific sensitive data
# Documentation: https://github.com/gitleaks/gitleaks#configuration

title = "HoliLabs Gitleaks Configuration"

# Extend default gitleaks rules
[extend]
useDefault = true

# NOTE: Healthcare-specific rules (hipaa-medical-record-number, brazil-cpf, brazil-cns)
# have been DISABLED because they produce too many false positives in a healthcare codebase.
# The terms "mrn", "medical record", "cpf", "cns" appear frequently in code as:
# - Variable names and type definitions
# - Function names (generateMRN, detectMRN)
# - Code comments and documentation
# - Test/seed data with fake values
#
# Instead, we rely on:
# 1. Code review processes
# 2. The allowlist patterns below for edge cases
# 3. Real secret detection for API keys, tokens, etc.

# ============================================================================
# ALLOWLIST - Paths and patterns to ignore
# ============================================================================

[allowlist]
description = "Allowlist for common false positives in healthcare codebase"

# Paths to ignore (regex patterns)
paths = [
    # Build and dependency directories
    '''\.git/''',
    '''node_modules/''',
    '''\.next/''',
    '''dist/''',
    '''build/''',
    '''coverage/''',
    '''\.turbo/''',
    '''\.pnpm-store/''',

    # Keys (cosign.key is encrypted and in .gitignore)
    '''cosign\.key''',
    '''\.key$''',

    # Test scripts
    '''test-.*\.sh''',
    '''scripts/test-''',

    # Local environment files (already in .gitignore, contain real secrets)
    '''\.env$''',
    '''\.env\.local''',
    '''\.env\.development''',
    '''\.env\.staging''',
    '''\.env\.test''',
    '''\.env\.sentry-build-plugin''',
    '''apps/.*/\.env''',

    # IDE and tool settings
    '''\.claude/''',
    '''\.vscode/''',
    '''\.idea/''',

    # Lock files
    '''pnpm-lock\.yaml''',
    '''package-lock\.json''',
    '''yarn\.lock''',

    # Test directories and files
    '''__tests__/''',
    '''\.test\.(ts|tsx|js|jsx)$''',
    '''\.spec\.(ts|tsx|js|jsx)$''',
    '''test-files/''',
    '''tests/''',

    # Seed and fixture files
    '''seed.*\.(ts|js)$''',
    '''prisma/seed''',
    '''fixtures/''',

    # Documentation (all markdown files)
    '''\.md$''',
    '''docs/''',
    '''\.github/''',

    # Build artifacts
    '''tsconfig\.tsbuildinfo''',
    '''gitleaks-report\.json''',

    # Example/template files
    '''\.example''',
    '''\.template''',
    '''\.sample''',

    # Scripts with example commands
    '''check-env\.sh''',
    '''setup.*\.sh''',

    # Prisma files
    '''prisma/''',
    '''\.prisma/''',

    # Source code directories (healthcare code has many MRN/CPF references)
    '''src/.*\.(ts|tsx|js|jsx)$''',
    '''lib/.*\.(ts|tsx|js|jsx)$''',
    '''components/.*\.(ts|tsx|js|jsx)$''',
    '''app/.*\.(ts|tsx|js|jsx)$''',
    '''packages/''',
]

# Specific files to ignore
files = [
    '''\.gitleaks\.toml$''',
    '''\.env\.example$''',
    '''\.env\.template$''',
    '''\.env\.sample$''',
    '''schema\.prisma$''',
]

# Regexes to allowlist (common false positives)
regexes = [
    # ============================================
    # PostgreSQL Connection Strings - Test/Example URLs
    # ============================================
    '''postgresql://user:pass''',
    '''postgresql://user:password''',
    '''postgresql://test:test''',
    '''postgresql://postgres:postgres''',
    '''postgresql://holi:''',
    '''postgresql://.*localhost''',
    '''postgresql://.*example''',
    '''postgresql://.*127\.0\.0\.1''',
    '''postgresql://.*@db:''',
    '''postgresql://.*PASSWORD@''',
    '''postgresql://.*your.*password''',
    '''postgresql://doadmin:secret@db-postgresql''',

    # ============================================
    # Test/Example API Keys and Secrets
    # ============================================
    '''(?i)example''',
    '''(?i)test.*key''',
    '''(?i)fake.*password''',
    '''(?i)dummy.*secret''',
    '''(?i)placeholder''',
    '''(?i)sample''',
    '''YOUR_.*_HERE''',
    '''your-.*-here''',
    '''REPLACE_.*''',
    '''TODO:''',
    '''FIXME:''',
    '''<.*>''',
    '''\$\{.*\}''',

    # ============================================
    # Documentation Patterns
    # ============================================
    '''(?i)readme''',
    '''# Example:''',
    '''// Example''',
    '''Format:.*postgresql''',
    '''REVOKE''',

    # ============================================
    # UUID format (not secrets)
    # ============================================
    '''\b[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\b''',

    # ============================================
    # Base64 Placeholder Patterns
    # ============================================
    '''cGxlYXNlLWdlbmVyYXRlLXlvdXItb3duLWtleQ==''',
    '''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9''',

    # ============================================
    # Development/Test Encryption Keys
    # ============================================
    '''holi-labs-encryption-key''',

    # ============================================
    # Google Client IDs (not secrets, just IDs)
    # ============================================
    '''\d{12}-[a-z0-9]+\.apps\.googleusercontent\.com''',
]

# Commits to ignore (known historical commits with false positives)
commits = []

# Stop words - content that definitely isn't a secret
stopwords = [
    "example",
    "test",
    "demo",
    "sample",
    "placeholder",
    "YOUR_",
    "REPLACE_",
    "TODO:",
    "FIXME:",
    "localhost",
    "127.0.0.1",
    "password",
    "secret",
    "template",
]
